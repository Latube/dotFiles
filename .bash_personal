#!/bin/bash

# set manual highlight
export LESS_TERMCAP_mb=$'\e[1;32m'
export LESS_TERMCAP_md=$'\e[1;32m'
export LESS_TERMCAP_me=$'\e[0m'
export LESS_TERMCAP_se=$'\e[0m'
export LESS_TERMCAP_so=$'\e[01;33m'
export LESS_TERMCAP_ue=$'\e[0m'
export LESS_TERMCAP_us=$'\e[1;4;31m'

# set global enviorment value
OSINFO=$(uname -a)
WSPACE=~/Documents/wspace

# file
alias cp='cp -i'
alias rm='rm -i'
alias mv='mv -i'

# directory
alias l='ls -shl'
alias l.='ls -d .*'
alias t1='tree -aL 1'
alias t2='tree -aL 2'
alias md='mkdir'
alias ..='cd ../'
alias ...='cd ../../'

# other
alias vi='vim'
alias c='clear'
alias ni='npm install'

# git
alias ga="git add"
alias gc="git commit"
alias gl="git pull"
alias gp="git push"
alias gst="git status"

# tmux
alias tls="tmux ls"

# history
export HISTCONTROL=ignoredups
export HISTSIZE=1000















# functions
mkcd(){
	md -p "$1" && cd "$1"
}










# Linux
if [[ $OSINFO == *"Linux"* ]];then
	export PS1="\[\e[36;40m\][\[\e[m\]\[\e[36m\]\u\[\e[m\]\[\e[36m\]@\[\e[m\]\[\e[36m\]\h\[\e[m\] \[\e[37m\]\W\[\e[m\]\[\e[36m\]]\[\e[m\]\[\e[36m\]\\$\[\e[m\] "
	alias la='ls -FsAlh --time-style=long-iso'
	alias ps='ps auxf'
	alias cdw='cd $WSPACE'
	
	# install vim plugin manager plug
	if [ ! -e ~/.vim/autoload ]; then
		curl -fLo ~/.vim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
	fi

	# install nodejs version manager
	if ! [ -e ~/.nvm/nvm.sh ]; then
		curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.0/install.sh | bash
		. ~/.bashrc
	fi

	# generate git ssh-key
	if [ ! -e ~/.ssh/ ];then
		ssh-keygen -t rsa -b 4096 -C "ytopt@hotmail.com"
	fi

fi


# WSL
if [[ $OSINFO == *"Microsoft"* ]]; then
	export WSPACE='/mnt/d/Users/PC-TT/wspace'
	alias cdw='cd /mnt/d/Users/PC-TT/wspace'
	alias cdc='cd /mnt/c'
	alias cdd='cd /mnt/d'
	alias cdg='cd /mnt/g'
fi


# CENTOS 7
if [[ $OSINFO == *"el7"* ]]; then

#################### install software ###################################
	# install software from offical origine
	sudo yum install -y wget unzip openssh-server tree

	# install git
	if ! [ -x "$(command -v git)" ]; then
		sudo yum install -y http://opensource.wandisco.com/centos/7/git/x86_64/wandisco-git-release-7-2.noarch.rpm
		sudo yum install -y git
	fi

	# install python3.7.0
	if ! [  -x "$(command -v python3)" ] ;then
		sudo yum install -y zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gcc make libffi-devel
		wget https://www.python.org/ftp/python/3.7.0/Python-3.7.0.tgz -O /tmp/Python3.7.0
		tar -xvf /tmp/Python3.7.0 && cd /tmp/Python3.7.0
		./configure prefix=/usr/local/python3 --enable-optimizations
		make && make install
		ln -s /usr/local/python3/bin/python3.7 /usr/bin/python3
		ln -s /usr/local/python3/bin/pip3.7 /usr/bin/pip3
	fi

	# upgrade vim version to the 8
	if ! [ -x "$(command -v vim)" ]; then
		scl enable devtoolset-3 bash
		yum install -y ncurses-devel
		wget https://github.com/vim/vim/archive/master.zip -O /tmp/master.zip
		cd /tmp
		unzip /tmp/master.zip
		cd /tmp/vim-master/src
		sudo ./configure --with-features=huge -enable-pythoninterp --with-python-config-dir=/usr/lib/python2.7/config
		sudo make && make install
		export PATH=/usr/local/bin:$PATH
	fi



#################### set directory ###################################

	# set work directory
	if [ ! -e ~/Documents/wspace ]; then
		mkdir -p $WSPACE/gitRepo
		mkdir -p $WSPACE/web
		mkdir -p $WSPACE/test
		mkdir -p $WSPACE/blog
	fi
	
	# remove the personal dotFiles folder to $WSPACE/gitRepo
	if [ -e ~/dotFiles ]; then
		mv ~/dotFiles $WSPACE/gitRepo/dotFiles
	fi

	# set links
	ln -sf $WSPACE/gitRepo/dotFiles/.bash_personal ~/.bashPersonal
	ln -sf $WSPACE/gitRepo/dotFiles/.gitconfig ~/.gitconfig
	ln -sf $WSPACE/gitRepo/dotFiles/.vimrc ~/.vimrc
	
	
	# set yum source
	#if [[ ! "$(grep 163 /etc/yum.repos.d/CentOS-Base.repo)" == *"163"* ]]; then
	#	mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup
	#	wget http://mirrors.163.com/.help/CentOS7-Base-163.repo -O /etc/yum.repos.d/CentOS-Base.repo && yum makecache
	#fi
fi








#################### other ###################################
 

# Ubuntu
if [[ $OSINFO == *"Ubuntu"* ]]; then
	echo "Ubuntu"
fi


# MACOS
if [[ $OSINFO == *"MBP"* ]]; then 
	alias cdw='cd $WSPACE'
	alias la='ls -FsAlhT'
	export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles
	export PATH="/usr/local/sbin:$PATH"
fi
